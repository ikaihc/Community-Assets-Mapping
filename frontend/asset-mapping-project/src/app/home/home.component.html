<main class="main-container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <label for="category-select">Please select one or more categories</label>

      <div class="custom-dropdown"
           (mouseenter)="dropdownOpen = true"
           (mouseleave)="dropdownOpen = false">
        <div class="dropdown-trigger">
          <div class="chips" *ngIf="selectedCategories.length > 0">
            <span *ngFor="let category of selectedCategories" class="chip">
              {{ category }}
              <button (click)="removeCategory(category); $event.stopPropagation()">&times;</button>
            </span>
          </div>
          <span *ngIf="selectedCategories.length === 0" class="placeholder">Select</span>
          <img src="assets/icons/Dropdown.svg" class="dropdown-icon" alt="Dropdown Arrow" />
        </div>

        <div class="dropdown-menu" *ngIf="dropdownOpen" (click)="$event.stopPropagation()">
          <div class="dropdown-group"
               *ngFor="let group of categoryGroups"
               (mouseenter)="hoveredGroup = group.name"
               (mouseleave)="hoveredGroup = null">
            <div class="group-label">
              {{ group.name }}
              <span class="arrow">&#8250;</span>
            </div>

            <div class="flyout" *ngIf="hoveredGroup === group.name">
              <div class="flyout-item"
                   *ngFor="let item of group.items"
                   [class.selected]="isSelected(item)"
                   (click)="toggleCategory(item); $event.stopPropagation()">
                {{ item }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <label for="asset-search">Search for asset:</label>
      <div class="search-wrapper">
        <input
          id="asset-search"
          type="text"
          placeholder="Ottawa Food Bank"
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
        />
        <img src="assets/icons/search.svg" alt="Search" class="search-icon" />
      </div>

      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="volunteerOnly" (change)="applyFilters()" />
        Look for Volunteer Opportunities
      </label>

      <!-- ðŸ”½ Divider added here -->
      <hr class="divider" />

    </div>

    <div class="asset-list">
      <div class="loading-indicator" *ngIf="isLoadingAssets">
        <p>Loading community assets...</p>
      </div>

      <div *ngIf="!isLoadingAssets && filteredAssets.length === 0" class="no-assets">
        <p>No assets found matching your criteria.</p>
      </div>

      <div
        *ngFor="let asset of filteredAssets"
        class="asset-card"
        (click)="onAssetClick(asset)"
        [title]="asset.description">
        <div class="asset-content">
          <strong class="asset-name">{{ asset.name }}</strong>
          <p class="asset-type">{{ asset.service_type || 'Community Asset' }}</p>
          <p class="asset-description" *ngIf="asset.description">{{ asset.description }}</p>
        </div>
      </div>
    </div>
  </aside>

  <section class="map-container">
    <div id="map"></div>
  </section>
</main>
